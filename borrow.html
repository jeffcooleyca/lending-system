<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>貸出フォーム / Borrow Form</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
    input, textarea, button { margin-top: 5px; padding: 5px; width: 100%; max-width: 400px; }
    button { width: auto; margin-top: 15px; }
  </style>
</head>
<body>
  <h2>貸出フォーム / Borrow Form</h2>

  <form id="borrowForm">
    <label>品名 / Item Name:
      <input type="text" id="itemName" required>
    </label>
    <label>数量 / Quantity:
      <input type="number" id="quantity" required min="1">
    </label>
    <label>メンバー / Member:
      <input type="text" id="member" required>
    </label>
    <label>備考 / Notes:
      <textarea id="notes"></textarea>
    </label>
    <button type="submit">送信 / Submit</button>
  </form>

  <p id="status"></p>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwjlcYtHr30JmDdQTG6SnYyl1z0rEbGrCwYtT1MtEmBfQyT3GhOHAa5ZNrbA4RGBhCZ/exec";

    const form = document.getElementById('borrowForm');
    const status = document.getElementById('status');

    // Load action and storage from sessionStorage
    const action = sessionStorage.getItem('currentAction') || 'borrow';
    const storage = sessionStorage.getItem('currentStorage') || 'Storage1';

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const payload = {
        日付: new Date().toISOString(),
        倉庫: storage,
        処理: action,
        品名: document.getElementById('itemName').value,
        数量: parseInt(document.getElementById('quantity').value),
        メンバー: document.getElementById('member').value,
        備考: document.getElementById('notes').value
      };

      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        if (data.result === 'success') {
          status.innerText = '送信完了 / Submitted successfully!';
          form.reset();
        } else {
          status.innerText = 'エラー / Error: ' + data.error;
        }
      })
      .catch(err => {
        status.innerText = 'エラー / Error: ' + err;
      });
    });
  </script>
</body>
</html>

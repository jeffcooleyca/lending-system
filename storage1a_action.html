<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è²¸å‡ºã‚·ã‚¹ãƒ†ãƒ  / Lending System</title>
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- =============================== -->
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« / Main Title -->
    <!-- =============================== -->
    <h2>ğŸ“¦ è²¸å‡ºã‚·ã‚¹ãƒ†ãƒ  / Lending System</h2>

    <!-- =========================================== -->
    <!-- ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå€‰åº«åï¼‰/ Subheader (Storage) -->
    <!-- =========================================== -->
    <h3>STORAGE1-Aï¼ˆã‚¹ãƒˆãƒƒã‚¯ç®¡ç†ã‚¨ãƒªã‚¢ï¼‰</h3>

    <!-- =============================================== -->
    <!-- æ“ä½œé¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ / Instruction for Action -->
    <!-- =============================================== -->
    <p>æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚<br>Select an action below:</p>

    <!-- =============================================== -->
    <!-- æ“ä½œãƒœã‚¿ãƒ³ / Action Buttons -->
    <!-- =============================================== -->
    <button onclick="goTo('borrow')">è²¸å‡º / Borrow</button>
    <button onclick="goTo('return')">è¿”å´ / Return</button>
    <button onclick="goTo('adjust')">èª¿æ•´ / Adjust</button>
    <button onclick="viewInventory()">åœ¨åº«ã‚’è¦‹ã‚‹ / View Inventory</button>

    <!-- =============================== -->
    <!-- ãƒ­ã‚´ / Company Logo -->
    <!-- =============================== -->
    <div style="margin-top:40px;">
      <img src="CA_Logo.jpg?v=9" alt="Company Logo" style="max-width:200px; width:50%; height:auto;">
    </div>
  </main>

  <!-- =============================== -->
  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ / Footer -->
  <!-- =============================== -->
  <footer>
    <p>Â© <span id="year"></span> ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæ ªï¼‰</p>
  </footer>

  <!-- =============================== -->
  <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ / Scripts -->
  <!-- =============================== -->
  <script>
    // å¹´ã‚’è‡ªå‹•æ›´æ–° / Auto-update the year
    document.getElementById("year").textContent = new Date().getFullYear();

    /**
     * goTo(action)
     * æŒ‡å®šã•ã‚ŒãŸæ“ä½œãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹é–¢æ•°
     * Function to navigate to the selected action page
     */
    function goTo(action) {
      window.location.href = `storage.html?action=${action}`;
    }

    /**
     * viewInventory()
     * STORAGE1-A ã®åœ¨åº«ã‚’ Web App ã‹ã‚‰å–å¾—ã—ã¦æ–°ã—ã„ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
     * Fetch inventory from the Web App and open in a new page
     */
    function viewInventory() {
      const webAppUrl = "https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec";
      
      // STORAGE1-A å›ºå®š / STORAGE1-A fixed
      const params = new URLSearchParams({ storage: "STORAGE1-A", action: "view" });

      fetch(`${webAppUrl}?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
          // JSON ã‚’ä¸€æ™‚çš„ã«æ–°ã—ã„ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
          // Create a new page to show the table
          const newWindow = window.open();
          let html = `<h2>STORAGE1-A åœ¨åº« / Inventory</h2>`;
          html += `<table border="1" style="border-collapse:collapse;width:100%;text-align:center;">`;
          html += "<tr>";
          // ãƒ˜ãƒƒãƒ€ãƒ¼ / Table header
          for (let key of Object.keys(data[0] || {})) {
            html += `<th>${key}</th>`;
          }
          html += "</tr>";
          // ãƒ‡ãƒ¼ã‚¿è¡Œ / Table rows
          data.forEach(row => {
            html += "<tr>";
            for (let key in row) {
              html += `<td>${row[key]}</td>`;
            }
            html += "</tr>";
          });
          html += "</table>";
          newWindow.document.write(html);
          newWindow.document.close();
        })
        .catch(error => {
          alert("åœ¨åº«å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ / Error fetching inventory:\n" + error);
        });
    }
  </script>
</body>
</html>

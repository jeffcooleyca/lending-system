<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STORAGE1-A 在庫表示 / Inventory View</title>
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <h2>STORAGE1-A 在庫表示</h2>

    <!-- ストック品と消耗品のテーブルを分ける -->
    <div id="stock-section">
      <h3>ストック品</h3>
      <table id="stock-table">
        <thead>
          <tr>
            <th>品名</th>
            <th>数量</th>
            <th>単価</th>
            <th>合計</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="3">総在庫コスト</td>
            <td id="stock-total">0</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div id="consumables-section">
      <h3>消耗品</h3>
      <table id="consumables-table">
        <thead>
          <tr>
            <th>品名</th>
            <th>数量</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </main>

  <footer>
    <p>© <span id="year"></span> クリエイティブエージェント（株）</p>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec';

    async function fetchInventory() {
      try {
        const res = await fetch(apiUrl);
        const json = await res.json();
        if(json.status !== 'success') throw new Error(json.message);

        const inventory = json.data;
        let stockTotal = 0;

        const stockTbody = document.querySelector('#stock-table tbody');
        const consumablesTbody = document.querySelector('#consumables-table tbody');

        stockTbody.innerHTML = '';
        consumablesTbody.innerHTML = '';

        inventory.forEach(item => {
          if(item.type === 'ストック') {
            stockTbody.innerHTML += `<tr>
              <td>${item.itemName}</td>
              <td>${item.quantity}</td>
              <td>${item.unitPrice}</td>
              <td>${item.totalCost}</td>
            </tr>`;
            stockTotal += Number(item.totalCost) || 0;
          } else if(item.type === '消耗品') {
            consumablesTbody.innerHTML += `<tr>
              <td>${item.itemName}</td>
              <td>${item.quantity}</td>
            </tr>`;
          }
        });

        document.getElementById('stock-total').textContent = stockTotal;

      } catch(err) {
        alert('在庫データの取得に失敗しました: ' + err.message);
      }
    }

    // ページ読み込み時にデータ取得
    window.onload = fetchInventory;
  </script>
</body>
</html>

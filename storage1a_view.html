<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STORAGE1-A åœ¨åº« / Inventory</title>
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- =============================== -->
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« / Main Title -->
    <!-- =============================== -->
    <h2>ğŸ“¦ è²¸å‡ºã‚·ã‚¹ãƒ†ãƒ  / Lending System</h2>

    <!-- ======================================= -->
    <!-- ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå€‰åº«åï¼‰/ Subheader (Storage) -->
    <!-- ======================================= -->
    <h3>STORAGE1-A<br>ï¼ˆã‚¹ãƒˆãƒƒã‚¯ç®¡ç†ã‚¨ãƒªã‚¢ï¼‰</h3>

    <!-- =============================== -->
    <!-- ç·åœ¨åº«ã‚³ã‚¹ãƒˆ / Total Inventory Cost -->
    <!-- =============================== -->
    <p id="totalInventoryCost">ç·åœ¨åº«ã‚³ã‚¹ãƒˆ: Â¥0</p>

    <!-- =============================== -->
    <!-- ã‚¹ãƒˆãƒƒã‚¯å“ / Stock Items -->
    <!-- =============================== -->
    <div class="collapsible-section">
      <button class="collapsible">ã‚¹ãƒˆãƒƒã‚¯å“</button>
      <div class="content">
        <!-- å„ã‚¢ã‚¤ãƒ†ãƒ ã¯ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ / Items will be dynamically added -->
        <div id="stock-items"></div>
      </div>
    </div>

    <!-- =============================== -->
    <!-- æ¶ˆè€—å“ / Consumables -->
    <!-- =============================== -->
    <div class="collapsible-section">
      <button class="collapsible">æ¶ˆè€—å“</button>
      <div class="content">
        <div id="consumables-items"></div>
      </div>
    </div>

  </main>

  <footer>
    <p>Â© <span id="year"></span> ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæ ªï¼‰</p>
  </footer>

  <script>
    // å¹´ã‚’è‡ªå‹•è¡¨ç¤º / Automatically display current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Collapsible sections
    const collapsibles = document.querySelectorAll(".collapsible");
    collapsibles.forEach(btn => {
      btn.addEventListener("click", function() {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        if(content.style.maxHeight){
          content.style.maxHeight = null;
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
        }
      });
    });

    // ===============================
    // ãƒ‡ãƒ¼ã‚¿å–å¾— / Fetch inventory data
    // ===============================
    async function fetchInventory() {
      const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec?action=view&storage=STORAGE1-A';

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();

        let totalCost = 0;
        const stockContainer = document.getElementById("stock-items");
        const consumablesContainer = document.getElementById("consumables-items");

        stockContainer.innerHTML = "";
        consumablesContainer.innerHTML = "";

        data.forEach(item => {
          if(item.type === "ã‚¹ãƒˆãƒƒã‚¯"){
            const unitCost = parseFloat(item.unitCost) || 0;
            const quantity = parseFloat(item.quantity) || 0;
            const itemTotal = unitCost * quantity;
            totalCost += itemTotal;

            const card = document.createElement("div");
            card.className = "item-card";
            card.innerHTML = `
              <div class="item-left">${item.name}</div>
              <div class="item-right">
                <p>æ•°é‡: ${quantity}</p>
                <p>å˜ä¾¡: Â¥${unitCost.toLocaleString()}</p>
                <p>åˆè¨ˆ: Â¥${itemTotal.toLocaleString()}</p>
              </div>
            `;
            stockContainer.appendChild(card);
          } else if(item.type === "æ¶ˆè€—å“"){
            const card = document.createElement("div");
            card.className = "item-card";
            card.innerHTML = `
              <div class="item-left">${item.name}</div>
              <div class="item-right">
                <p>æ•°é‡: ${item.quantity}</p>
              </div>
            `;
            consumablesContainer.appendChild(card);
          }
        });

        document.getElementById("totalInventoryCost").textContent = `ç·åœ¨åº«ã‚³ã‚¹ãƒˆ: Â¥${totalCost.toLocaleString()}`;

      } catch(err) {
        console.error("åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ / Failed to fetch inventory data", err);
      }
    }

    fetchInventory();
  </script>
</body>
</html>

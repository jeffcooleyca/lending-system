<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ¨åº«ä¸€è¦§ / Inventory View - STORAGE1A</title>

  <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ / Shared CSS -->
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« / Main Title -->
    <h2>ğŸ“¦ STORAGE1A åœ¨åº«ä¸€è¦§ / Inventory View</h2>

    <!-- ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ« / Subheader -->
    <h3>STORAGE1-Aï¼ˆã‚¹ãƒˆãƒƒã‚¯ç®¡ç†ã‚¨ãƒªã‚¢ï¼‰</h3>

    <!-- ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ / Instruction -->
    <p>åœ¨åº«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>Check the inventory below:</p>

    <!-- åœ¨åº«ãƒ†ãƒ¼ãƒ–ãƒ« / Inventory Table -->
    <table id="inventoryTable">
      <thead>
        <tr>
          <th>å“å</th>
          <th>æ•°é‡</th>
          <th>å˜ä¾¡</th>
          <th>åˆè¨ˆé‡‘é¡</th>
        </tr>
      </thead>
      <tbody>
        <!-- ãƒ‡ãƒ¼ã‚¿ã¯JavaScriptã§æŒ¿å…¥ã•ã‚Œã¾ã™ / Data will be inserted via JavaScript -->
      </tbody>
    </table>

    <!-- åˆè¨ˆé‡‘é¡ / Total Inventory Value -->
    <p id="totalCost">åˆè¨ˆé‡‘é¡: 0</p>
  </main>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ / Footer -->
  <footer>
    <p>Â© <span id="year"></span> ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæ ªï¼‰</p>
  </footer>

  <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ / Scripts -->
  <script>
    // ç¾åœ¨ã®å¹´ã‚’ãƒ•ãƒƒã‚¿ãƒ¼ã«è¡¨ç¤º / Automatically display current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // API URL for STORAGE1A
    // STORAGE1Aç”¨ã®Webã‚¢ãƒ—ãƒªURL / Your deployed Web App URL
    const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec?action=view&storage=STORAGE1A';

    /**
     * fetchInventory
     * Google Sheetsã‹ã‚‰åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤ºã™ã‚‹
     * Fetches inventory data from Google Sheets via API and populates the table
     */
    async function fetchInventory() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === 'success') {
          const tableBody = document.querySelector('#inventoryTable tbody');
          tableBody.innerHTML = '';

          let totalInventoryCost = 0;

          data.items.forEach(item => {
            // æ¶ˆè€—å“ã®å ´åˆã¯å˜ä¾¡ã¨åˆè¨ˆé‡‘é¡ã¯è¡¨ç¤ºã—ãªã„ / For consumables, omit unit price and total cost
            const isConsumable = item.category === 'æ¶ˆè€—å“';
            const unitPrice = isConsumable ? '' : item.unitPrice;
            const total = isConsumable ? '' : item.totalCost;

            // åˆè¨ˆé‡‘é¡ã®è¨ˆç®—ï¼ˆæ¶ˆè€—å“ä»¥å¤–ï¼‰ / Running total for non-consumables
            if (!isConsumable) totalInventoryCost += item.totalCost;

            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.name}</td>
              <td>${item.quantity}</td>
              <td>${unitPrice}</td>
              <td>${total}</td>
            `;
            tableBody.appendChild(row);
          });

          document.getElementById('totalCost').textContent = `åˆè¨ˆé‡‘é¡: ${totalInventoryCost.toLocaleString()} å††`;
        } else {
          alert('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ / Failed to fetch inventory data');
        }
      } catch (error) {
        console.error('Error fetching inventory:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ / An error occurred while fetching inventory');
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— / Fetch inventory on page load
    window.addEventListener('DOMContentLoaded', fetchInventory);
  </script>
</body>
</html>

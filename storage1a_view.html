<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STORAGE1-A 在庫 / Inventory</title>
  <link rel="stylesheet" href="styles.css?v=10">
</head>
<body>
  <main>
    <h2>STORAGE1-A（ストック管理エリア）</h2>
    <p>在庫情報を表示しています。</p>

    <!-- ストック品テーブル / Stock Table -->
    <h3>ストック / Stock</h3>
    <table id="stockTable">
      <thead>
        <tr>
          <th>アイテム名</th>
          <th>数量</th>
          <th>単価</th>
          <th>合計</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="3">総在庫コスト</td>
          <td id="totalInventoryCost">0</td>
        </tr>
      </tfoot>
    </table>

    <!-- 消耗品テーブル / Consumables Table -->
    <h3>消耗品 / Consumables</h3>
    <table id="consumablesTable">
      <thead>
        <tr>
          <th>アイテム名</th>
          <th>数量</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <footer>
    <p>© <span id="year"></span> クリエイティブエージェント（株）</p>
  </footer>

  <script>
    // 現在の年を自動表示
    document.getElementById("year").textContent = new Date().getFullYear();

    const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec?action=view&storage=STORAGE1A';

    async function fetchInventory() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status !== "success") {
          throw new Error(data.message || "データ取得に失敗しました");
        }

        // ===== ストック品の表示 / Stock =====
        const stockTbody = document.querySelector("#stockTable tbody");
        stockTbody.innerHTML = "";
        if (Array.isArray(data.stock) && data.stock.length) {
          data.stock.forEach(item => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.item || ""}</td>
              <td>${item.quantity || 0}</td>
              <td>${item.unitCost || 0}</td>
              <td>${item.totalCost || 0}</td>
            `;
            stockTbody.appendChild(tr);
          });
        } else {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td colspan="4">データがありません</td>`;
          stockTbody.appendChild(tr);
        }

        document.getElementById("totalInventoryCost").textContent = data.totalInventoryCost || 0;

        // ===== 消耗品の表示 / Consumables =====
        const consumablesTbody = document.querySelector("#consumablesTable tbody");
        consumablesTbody.innerHTML = "";
        if (Array.isArray(data.consumables) && data.consumables.length) {
          data.consumables.forEach(item => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.item || ""}</td>
              <td>${item.quantity || 0}</td>
            `;
            consumablesTbody.appendChild(tr);
          });
        } else {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td colspan="2">データがありません</td>`;
          consumablesTbody.appendChild(tr);
        }

      } catch (err) {
        alert("在庫データ取得に失敗しました: " + err.message);
        console.error(err);
      }
    }

    window.addEventListener("DOMContentLoaded", fetchInventory);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STORAGE1-A åœ¨åº«ç¢ºèª / Inventory View</title>
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- =============================================== -->
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« / Main Title -->
    <!-- =============================================== -->
    <h2>STORAGE1-A åœ¨åº«ç¢ºèª / Inventory View</h2>

    <!-- =============================================== -->
    <!-- ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ / Loading message -->
    <!-- =============================================== -->
    <p id="loadingMsg">åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­â€¦ / Loading inventory dataâ€¦</p>

    <!-- =============================================== -->
    <!-- ã‚¹ãƒˆãƒƒã‚¯å“ãƒ†ãƒ¼ãƒ–ãƒ« / Stock Table -->
    <!-- =============================================== -->
    <h3>ã‚¹ãƒˆãƒƒã‚¯å“ / Stock Items</h3>
    <table id="stockTable">
      <thead>
        <tr>
          <th>å“ç›®å</th>
          <th>æ•°é‡</th>
          <th>å˜ä¾¡</th>
          <th>åˆè¨ˆé‡‘é¡</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="3">ç·åœ¨åº«ã‚³ã‚¹ãƒˆ / Total Inventory Cost</td>
          <td id="totalInventoryCost"></td>
        </tr>
      </tfoot>
    </table>

    <!-- =============================================== -->
    <!-- æ¶ˆè€—å“ãƒ†ãƒ¼ãƒ–ãƒ« / Consumables Table -->
    <!-- =============================================== -->
    <h3>æ¶ˆè€—å“ / Consumables</h3>
    <table id="consumablesTable">
      <thead>
        <tr>
          <th>å“ç›®å</th>
          <th>æ•°é‡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <!-- =============================================== -->
  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ / Footer -->
  <!-- =============================================== -->
  <footer>
    <p>Â© <span id="year"></span> ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæ ªï¼‰</p>
  </footer>

  <!-- =============================================== -->
  <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ / Scripts -->
  <!-- =============================================== -->
  <script>
    // ç¾åœ¨ã®å¹´ã‚’ãƒ•ãƒƒã‚¿ãƒ¼ã«è‡ªå‹•è¡¨ç¤º / Auto-display current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // API URL ã‚’æŒ‡å®š / Your deployed LendingSystem_API Web App URL
    const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec?action=view&storage=STORAGE1A';

    /**
     * fetchInventory()
     * Web App ã‹ã‚‰åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤º
     * Fetch inventory data from Web App and populate tables
     */
    async function fetchInventory() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status !== 'success') {
          throw new Error(data.message || 'åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ / Failed to fetch inventory');
        }

        // ===============================
        // ğŸ‘‡ ã‚¹ãƒˆãƒƒã‚¯å“ / Stock Items
        // ===============================
        const stockTbody = document.querySelector('#stockTable tbody');
        stockTbody.innerHTML = ''; // æ—¢å­˜è¡Œã‚’ã‚¯ãƒªã‚¢ / Clear existing rows

        data.stockItems.forEach(item => {
          const tr = document.createElement('tr');

          // td: Item Name / å“ç›®å
          const tdName = document.createElement('td');
          tdName.textContent = item.itemName;
          tr.appendChild(tdName);

          // td: Quantity / æ•°é‡
          const tdQty = document.createElement('td');
          tdQty.textContent = item.quantity;
          tr.appendChild(tdQty);

          // td: Unit Cost / å˜ä¾¡
          const tdUnit = document.createElement('td');
          tdUnit.textContent = item.unitCost.toLocaleString();
          tr.appendChild(tdUnit);

          // td: Total Cost / åˆè¨ˆé‡‘é¡
          const tdTotal = document.createElement('td');
          tdTotal.textContent = item.totalCost.toLocaleString();
          tr.appendChild(tdTotal);

          stockTbody.appendChild(tr);
        });

        // ç·åœ¨åº«ã‚³ã‚¹ãƒˆ / Total inventory cost
        document.getElementById('totalInventoryCost').textContent = data.totalInventoryCost.toLocaleString();

        // ===============================
        // ğŸ‘‡ æ¶ˆè€—å“ / Consumables
        // ===============================
        const consumablesTbody = document.querySelector('#consumablesTable tbody');
        consumablesTbody.innerHTML = ''; // æ—¢å­˜è¡Œã‚’ã‚¯ãƒªã‚¢

        data.consumables.forEach(item => {
          const tr = document.createElement('tr');

          // td: Item Name / å“ç›®å
          const tdName = document.createElement('td');
          tdName.textContent = item.itemName;
          tr.appendChild(tdName);

          // td: Quantity / æ•°é‡
          const tdQty = document.createElement('td');
          tdQty.textContent = item.quantity;
          tr.appendChild(tdQty);

          consumablesTbody.appendChild(tr);
        });

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º / Hide loading message
        document.getElementById('loadingMsg').style.display = 'none';

      } catch (err) {
        console.error(err);
        document.getElementById('loadingMsg').textContent = 'åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ / Failed to fetch inventory data';
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ / Run on page load
    window.addEventListener('DOMContentLoaded', fetchInventory);
  </script>
</body>
</html>

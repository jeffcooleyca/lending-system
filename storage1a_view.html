<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>在庫確認 | STORAGE1-A</title>
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- =============================== -->
    <!-- メインタイトル / Main Title -->
    <!-- =============================== -->
    <h2>STORAGE1-A（ストック管理エリア）</h2>
    <p>在庫を確認してください</p>

    <!-- =============================== -->
    <!-- ストックテーブル / Stock Table -->
    <!-- =============================== -->
    <h3>ストック</h3>
    <table id="stockTable">
      <thead>
        <tr>
          <th>品目名</th>
          <th>数量</th>
          <th>単価</th>
          <th>合計金額</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="3">合計金額</td>
          <td id="stockTotal">0</td>
        </tr>
      </tfoot>
    </table>

    <!-- =============================== -->
    <!-- 消耗品テーブル / Consumables Table -->
    <!-- =============================== -->
    <h3>消耗品</h3>
    <table id="consumablesTable">
      <thead>
        <tr>
          <th>品目名</th>
          <th>数量</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </main>

  <!-- =============================== -->
  <!-- フッター / Footer -->
  <!-- =============================== -->
  <footer>
    <p>© <span id="year"></span> クリエイティブエージェント（株）</p>
  </footer>

  <script>
    // 現在の年をフッターに表示 / Automatically display current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // ===============================
    // Web App URL / 必ず最新のデプロイURLに置き換える
    // ===============================
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec';

    // データ取得 / Fetch data from Web App
    fetch(`${webAppUrl}?storage=STORAGE1-A&action=view`)
      .then(response => response.json())
      .then(data => {
        let stockTotal = 0;

        // ストック / Stock items
        const stockTbody = document.querySelector("#stockTable tbody");
        data.forEach(item => {
          if(item.type === 'ストック') {
            const tr = document.createElement("tr");

            const totalPrice = item.quantity * item.unitPrice;
            stockTotal += totalPrice;

            tr.innerHTML = `
              <td>${item.name}</td>
              <td>${item.quantity}</td>
              <td>${item.unitPrice}</td>
              <td>${totalPrice}</td>
            `;
            stockTbody.appendChild(tr);
          }
        });

        document.getElementById("stockTotal").textContent = stockTotal;

        // 消耗品 / Consumables
        const consumablesTbody = document.querySelector("#consumablesTable tbody");
        data.forEach(item => {
          if(item.type === '消耗品') {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.name}</td>
              <td>${item.quantity}</td>
            `;
            consumablesTbody.appendChild(tr);
          }
        });
      })
      .catch(error => {
        console.error("データ取得エラー:", error);
        alert("在庫データの取得に失敗しました。");
      });
  </script>
</body>
</html>

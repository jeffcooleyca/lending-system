<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STORAGE1-A åœ¨åº«ç¢ºèª / View Inventory</title>
  <!-- ğŸ“„ å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ / Load shared stylesheet -->
  <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
  <main>
    <!-- =============================== -->
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« / Main Title -->
    <!-- =============================== -->
    <h2>ğŸ“¦ STORAGE1-A åœ¨åº«ç¢ºèª / View Inventory</h2>

    <!-- =========================================== -->
    <!-- ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ« / Subheader -->
    <!-- =========================================== -->
    <h3>STOCKï¼ˆã‚¹ãƒˆãƒƒã‚¯å“ï¼‰</h3>
    <table id="stockTable">
      <thead>
        <tr>
          <th>å“å / Item Name</th>
          <th>æ•°é‡ / Quantity</th>
          <th>å˜ä¾¡ / Unit Cost</th>
          <th>åˆè¨ˆ / Total Cost</th>
        </tr>
      </thead>
      <tbody>
        <!-- ãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ / Data will be populated here -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">ç·åœ¨åº«ã‚³ã‚¹ãƒˆ / Total Inventory Cost</td>
          <td id="totalInventoryCost">Â¥0</td>
        </tr>
      </tfoot>
    </table>

    <h3>CONSUMABLESï¼ˆæ¶ˆè€—å“ï¼‰</h3>
    <table id="consumablesTable">
      <thead>
        <tr>
          <th>å“å / Item Name</th>
          <th>æ•°é‡ / Quantity</th>
        </tr>
      </thead>
      <tbody>
        <!-- ãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ / Data will be populated here -->
      </tbody>
    </table>

    <!-- ğŸ“Œ æˆ»ã‚‹ãƒœã‚¿ãƒ³ / Back Button -->
    <button onclick="goBack()">â† å€‰åº«é¸æŠã«æˆ»ã‚‹ / Back to Storage Selection</button>
  </main>

  <!-- ğŸ¢ ãƒ­ã‚´ / Company Logo -->
  <div class="logo-container">
    <img src="CA_Logo.jpg?v=9" alt="Creative Agent Logo" class="company-logo">
  </div>

  <!-- ğŸ§¾ ãƒ•ãƒƒã‚¿ãƒ¼ / Footer -->
  <footer>
    <p>Â© <span id="year"></span> ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæ ªï¼‰</p>
  </footer>

  <script>
    // ç¾åœ¨ã®å¹´ã‚’ãƒ•ãƒƒã‚¿ãƒ¼ã«è¡¨ç¤º / Display current year in footer
    document.getElementById("year").textContent = new Date().getFullYear();

    // API URL for Storage1A / LendingSystem_API Web App deployment
    const apiUrl = 'https://script.google.com/macros/s/AKfycbw3c4Cy9UKPcToj9sIPIaues2QaHFMiDq6mfJuZrFnLr91b-omPycecyHvIy-I6zzhOfw/exec?action=view&storage=STORAGE1A';

    /**
     * fetchInventoryData()
     * Google Apps Script Web App ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤º
     * Fetch data from Google Sheets via Web App and populate tables
     */
    async function fetchInventoryData() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === 'success') {
          const stockTableBody = document.querySelector('#stockTable tbody');
          const consumablesTableBody = document.querySelector('#consumablesTable tbody');
          let totalCost = 0;

          // ãƒ‡ãƒ¼ã‚¿ã‚’ STOCK ã¨ CONSUMABLES ã«æŒ¯ã‚Šåˆ†ã‘ / Split STOCK vs CONSUMABLES
          data.items.forEach(item => {
            if (item.category === 'STOCK') {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>Â¥${item.unitCost.toLocaleString()}</td>
                <td>Â¥${item.totalCost.toLocaleString()}</td>
              `;
              stockTableBody.appendChild(row);
              totalCost += item.totalCost;
            } else if (item.category === 'CONSUMABLE') {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${item.name}</td>
                <td>${item.quantity}</td>
              `;
              consumablesTableBody.appendChild(row);
            }
          });

          // ç·åœ¨åº«ã‚³ã‚¹ãƒˆã‚’æ›´æ–° / Update total inventory cost
          document.getElementById('totalInventoryCost').textContent = `Â¥${totalCost.toLocaleString()}`;
        } else {
          alert('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ / Failed to fetch inventory data');
          console.error(data.message);
        }
      } catch (err) {
        alert('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ / Error fetching inventory data');
        console.error(err);
      }
    }

    // å€‰åº«é¸æŠãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ / Go back to storage selection page
    function goBack() {
      window.location.href = 'index.html';
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿å–å¾— / Fetch data on page load
    window.addEventListener('DOMContentLoaded', fetchInventoryData);
  </script>
</body>
</html>
